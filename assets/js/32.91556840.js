(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{459:function(e,i,o){"use strict";o.r(i);var n=o(0),s=Object(n.a)({},(function(){var e=this,i=e._self._c;return i("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[i("div",{staticClass:"custom-block warning"},[i("p",{staticClass:"custom-block-title"},[e._v("BUG梳理")]),e._v(" "),i("p",[e._v("关于反向代理gpt开发过程中碰到一些服务器问题")])]),e._v(" "),i("h2",{attrs:{id:"一些linux常见命令"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#一些linux常见命令"}},[e._v("#")]),e._v(" 一些linux常见命令")]),e._v(" "),i("p",[e._v("删除\n"),i("code",[e._v("rm nginx.conf")]),e._v("\n复制nginx.conf 到etc/nginxcls")]),e._v(" "),i("p",[i("code",[e._v("sudo cp nginx.conf /etc/nginx/")])]),e._v(" "),i("p",[e._v("复制.env到service\n"),i("code",[e._v("sudo cp .env /home/lighthouse/myblog/service")])]),e._v(" "),i("p",[e._v("启动\n"),i("code",[e._v("nginxsudo nginx -t")])]),e._v(" "),i("p",[e._v("重新启动nginx"),i("br"),e._v(" "),i("code",[e._v("sudo systemctl reload nginx")])]),e._v(" "),i("p",[e._v("查看nginx是否配置正确"),i("br"),e._v(" "),i("code",[e._v("nginx -t")])]),e._v(" "),i("p",[e._v("查看nginx状态"),i("br"),e._v(" "),i("code",[e._v("sudo systemctl status nginx")])]),e._v(" "),i("p",[e._v("查看nginx配置文件是否有问题"),i("br"),e._v(" "),i("code",[e._v("sudo nginx -t")])]),e._v(" "),i("p",[e._v("查看nginx错误日志"),i("br"),e._v(" "),i("code",[e._v("sudo tail -f /var/log/nginx/error.log")])]),e._v(" "),i("p",[e._v("删除除service夹以外文件"),i("br"),e._v(" "),i("code",[e._v("rm -rf !(service)")])]),e._v(" "),i("p",[e._v("新增一个暂时文件夹"),i("br"),e._v(" "),i("code",[e._v("mkdir temp")])]),e._v(" "),i("h2",{attrs:{id:"关于博客反向代理开发过程中碰到的问题"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#关于博客反向代理开发过程中碰到的问题"}},[e._v("#")]),e._v(" 关于博客反向代理开发过程中碰到的问题")]),e._v(" "),i("p",[e._v("调了一下午最终又报错页面可以进了，却显示403，进默认页面是可以的。大概率是权限问题"),i("br"),e._v("\n查看一下:"),i("br"),e._v(" "),i("code",[e._v("ls -ld")]),i("br"),e._v("\n应该是"),i("br"),e._v("\n看下日志   "),i("code",[e._v('2023/05/14 17:21:14 [notice] 20542#20542: signal process started 2023/05/14 17:21:15 [error] 20543#20543: *24 "/home/lighthouse/myblog/dist/html/index.html" is forbidden (13: Permission denied), client: 220.196.160.154, server: zhixi.online, request: "GET / HTTP/1.1", host: "zhixi.online" 2023/05/14 17:21:28 [error] 20544#20544: *25 "/home/lighthouse/myblog/dist/html/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16" 2023/05/14 17:21:29 [error] 20543#20543: *26 "/home/lighthouse/myblog/dist/html/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16" 2023/05/14 17:21:30 [error] 20543#20543: *27 "/home/lighthouse/myblog/dist/html/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16" 2023/05/14 17:21:31 [error] 20544#20544: *28 "/home/lighthouse/myblog/dist/html/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16" 2023/05/14 17:22:44 [error] 20543#20543: *29 open() "/home/lighthouse/myblog/dist/html/img/header-background.png" failed (13: Permission denied), client: 1.13.138.14, server: zhixi.online, request: "GET /img/header-background.png HTTP/1.1", host: "124.221.209.16", referrer: "http://124.221.209.16/" 2023/05/14 17:22:44 [error] 20544#20544: *30 open() "/home/lighthouse/myblog/dist/html/img/header-background.png" failed (13: Permission denied), client: 59.36.132.153, server: zhixi.online, request: "GET /img/header-background.png HTTP/1.1", host: "124.221.209.16" 2023/05/14 17:22:44 [error] 20543#20543: *31 open() "/home/lighthouse/myblog/dist/html/img/header-background.png" failed (13: Permission denied), client: 119.147.3.102, server: zhixi.online, request: "GET /img/header-background.png HTTP/1.1", host: "124.221.209.16" 2023/05/14 17:22:44 [error] 20543#20543: *32 open() "/home/lighthouse/myblog/dist/html/img/header-background.png" failed (13: Permission denied), client: 106.55.200.145, server: zhixi.online, request: "GET /img/header-background.png HTTP/1.1", host: "124.221.209.16"')])]),e._v(" "),i("p",[e._v("果然，想想办法，不太想移动文件夹，"),i("br"),e._v("\n用\n"),i("code",[e._v("chmod o+rx /home/lighthouse/myblog/dist/html")]),e._v("\n试试\n还是不成")]),e._v(" "),i("p",[e._v("再试下，低级失误，我就没html文件夹。。")]),e._v(" "),i("p",[e._v("还是报错403"),i("br"),e._v("\nserver {\n...\nroot /home/lighthouse/myblog/dist;\n...\n}")]),e._v(" "),i("p",[e._v("location / {\ntry_files $uri $uri/ /index.html;\n}")]),e._v(" "),i("p",[e._v("，不知道是网页错误还是权限不够，nginx中配置应该是对的。\n再看下权限问题"),i("br"),e._v(" "),i("code",[e._v("[lighthouse@VM-4-6-centos temp]$ ls -l /home/lighthouse/myblog/dist total 264 drwxr-x--- 2 lighthouse lighthouse 4096 May 14 08:25 assets -rw-r----- 1 lighthouse lighthouse 41662 May 14 08:25 favicon.ico -rw-r----- 1 lighthouse lighthouse 1049 May 14 08:25 favicon.svg -rw-r----- 1 lighthouse lighthouse 1715 May 14 08:25 index.html -rw-r----- 1 lighthouse lighthouse 6143 May 14 08:25 indexpng.png -rw-r----- 1 lighthouse lighthouse 7361 May 14 08:25 pwa-192x192.png -rw-r----- 1 lighthouse lighthouse 34373 May 14 08:25 pwa-512x512.png -rw-r----- 1 lighthouse lighthouse 90565 May 14 08:25 zanshangma.jpg -rw-r----- 1 lighthouse lighthouse 63762 May 14 08:25 微信图片_20230419014916.jpg [lighthouse@VM-4-6-centos temp]$")])]),e._v(" "),i("p",[e._v("这个文件夹权限应该是对的，再看下nginx相关的"),i("br"),e._v(" "),i("code",[e._v("[lighthouse@VM-4-6-centos temp]$ ps -ef | grep nginx root 12914 1 0 17:41 ? 00:00:00 nginx: master process /usr/sbin/nginx nginx 12915 12914 0 17:41 ? 00:00:00 nginx: worker process nginx 12916 12914 0 17:41 ? 00:00:00 nginx: worker process lightho+ 22347 27493 0 17:44 pts/14 00:00:00 grep --color=auto nginx root 25204 1 0 17:22 ? 00:00:00 sudo tail -f /var/log/nginx/error.log root 25205 25204 0 17:22 ? 00:00:00 tail -f /var/log/nginx/error.log [lighthouse@VM-4-6-centos temp]$")])]),e._v(" "),i("p",[e._v("也特么没问题额，看日志吧")]),e._v(" "),i("div",{staticClass:"language- extra-class"},[i("pre",[i("code",[e._v('```sudo tail -f /var/log/nginx/error.log```\n\n```2023/05/14 17:33:37 [notice] 22930#22930: signal process started\n2023/05/14 17:33:42 [error] 22931#22931: *33 "/home/lighthouse/myblog/dist/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16"\n')])])]),i("p",[e._v('2023/05/14 17:33:44 [error] 22932#22932: *34 "/home/lighthouse/myblog/dist/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16"\n2023/05/14 17:33:45 [error] 22931#22931: *35 "/home/lighthouse/myblog/dist/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16"\n2023/05/14 17:33:46 [error] 22932#22932: *36 "/home/lighthouse/myblog/dist/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16"\n2023/05/14 17:33:47 [error] 22931#22931: *37 "/home/lighthouse/myblog/dist/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16"\n2023/05/14 17:36:44 [error] 22931#22931: *38 "/home/lighthouse/myblog/dist/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16"\n2023/05/14 17:38:57 [error] 22932#22932: *39 "/home/lighthouse/myblog/dist/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16"\n2023/05/14 17:39:10 [error] 22932#22932: *40 "/home/lighthouse/myblog/dist/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16"\n2023/05/14 17:41:36 [error] 12916#12916: *1 "/home/lighthouse/myblog/dist/index.html" is forbidden (13: Permission denied), client: 124.14.214.52, server: zhixi.online, request: "GET / HTTP/1.1", host: "124.221.209.16"```')]),e._v(" "),i("p",[e._v("果然是权限问题\n由于权限问题而被拒")]),e._v(" "),i("div",{staticClass:"language- extra-class"},[i("pre",[i("code",[e._v("[lighthouse@VM-4-6-centos ~]$ ls -l /home/lighthouse/myblog/dist/index.html-rw-r----- 1 lighthouse lighthouse 1715 May 14 08:25 /home/lighthouse/myblog/dist/index.html\n")])])]),i("p",[e._v("[lighthouse@VM-4-6-centos ~]$"),i("br"),e._v("\n这个只有所有者才能访问\n再看下我的nginx组名称")]),e._v(" "),i("p",[e._v("[lighthouse@VM-4-6-centos ~]$ ps aux | grep nginx lightho+ 4072 0.0 0.0 112812 980 pts/16 S+ 17:49 0:00 grep --color=auto nginx root 12914 0.0 0.0 39308 988 ? Ss 17:41 0:00 nginx: master process /usr/sbin/nginx nginx 12915 0.0 0.1 41936 2448 ? S 17:41 0:00 nginx: worker process nginx 12916 0.0 0.1 41936 2476 ? S 17:41 0:00 nginx: worker process root 25142 0.0 0.2 245564 4716 ? S 17:45 0:00 sudo tail -f /var/log/nginx/error.log root 25143 0.0 0.0 108096 620 ? S 17:45 0:00 tail -f /var/log/nginx/error.log root 25204 0.0 0.2 245564 4716 ? S 17:22 0:00 sudo tail -f /var/log/nginx/error.log root 25205 0.0 0.0 108096 620 ? S 17:22 0:00 tail -f /var/log/nginx/error.log [lighthouse@VM-4-6-centos ~]$")]),e._v(" "),i("p",[e._v("Nginx进程的用户是nginx，而Nginx进程的组是nginx。")]),e._v(" "),i("p",[e._v("直接加权"),i("br"),e._v(" "),i("code",[e._v("sudo chown :nginx /home/lighthouse/myblog/dist/index.html sudo chmod g+r /home/lighthouse/myblog/dist/index.html")]),i("br"),e._v("\n理论上应该好了，重启看下"),i("br"),e._v(" "),i("code",[e._v("sudo systemctl restart nginx")])]),e._v(" "),i("p",[e._v("还是不行，我吐呀这个权限\n再看眼日志还是没访问权限，"),i("br"),e._v(" "),i("code",[e._v('$ sudo su nginx -s /bin/bash -c "cat /home/lighthouse/myblog/dist/index.html"')])]),e._v(" "),i("p",[e._v("还是没权限，但刚才权限是加好了额，这腾讯云真逆天不是人用的。")]),e._v(" "),i("p",[e._v("也不对啊，我查看权限nginxJg是有的额"),i("br"),e._v("\n[lighthouse@VM-4-6-centos ~]$ ls -l /home/lighthouse/myblog/dist/\ntotal 264\ndrwxr-x--- 2 lighthouse lighthouse  4096 May 14 08:25 assets\n-rw-r----- 1 lighthouse lighthouse 41662 May 14 08:25 favicon.ico\n-rw-r----- 1 lighthouse lighthouse  1049 May 14 08:25 favicon.svg\n-rw-r--r-- 1 nginx      nginx       1715 May 14 08:25 index.html\n-rw-r----- 1 lighthouse lighthouse  6143 May 14 08:25 indexpng.png\n-rw-r----- 1 lighthouse lighthouse  7361 May 14 08:25 pwa-192x192.png\n-rw-r----- 1 lighthouse lighthouse 34373 May 14 08:25 pwa-512x512.png\n-rw-r----- 1 lighthouse lighthouse 90565 May 14 08:25 zanshangma.jpg\n-rw-r----- 1 lighthouse lighthouse 63762 May 14 08:25 微信图片_20230419014916.jpg\n[lighthouse@VM-4-6-centos ~]$ sudo chmod 644 /home/lighthouse/myblog/dist/index.html\n[lighthouse@VM-4-6-centos ~]$")]),e._v(" "),i("p",[e._v("弄了好多天了，备案加各种乱七八糟的原因\n结果特么居然是反向代理被SX防火墙给卡了，\n如果您的服务器上启用了防火墙，您需要确保已经配置了正确的规则以允许反向代理流量通过。\n如果您使用的是 Linux 系统的防火墙工具（如 iptables），您可以添加适当的规则来允许反向代理流量。例如，如果您使用的是默认的 HTTP 端口 80 和 HTTPS 端口 443，您可以执行以下命令：")]),e._v(" "),i("p",[e._v("bashCopy code\nsudo iptables -I INPUT -p tcp --dport 80 -j ACCEPT sudo iptables -I INPUT -p tcp --dport 443 -j ACCEPT\n这将允许进入端口 80 和 443 的 TCP 流量通过防火墙。\n如果您使用的是其他防火墙工具，如 UFW（Uncomplicated Firewall），您可以使用类似的命令来打开相应的端口。\n请注意，具体的防火墙配置可能因您使用的操作系统和防火墙工具而有所不同。建议查阅您所使用的防火墙工具的文档或参考相关资源以获取准确的配置步骤。\n配置完成后，重新加载防火墙规则，以使更改生效。")]),e._v(" "),i("p",[e._v("对于 CentOS/RHEL 系统，可以使用以下命令来检查防火墙状态：")]),e._v(" "),i("p",[e._v("sudo systemctl status firewalld")]),e._v(" "),i("p",[e._v("查看防火墙规则和配置\nsudo firewall-cmd --list-all\n果然，我是个智障，打开80和443出口\nsudo iptables -I INPUT -p tcp --dport 80 -j ACCEPT\nsudo iptables -I INPUT -p tcp --dport 443 -j ACCEPT")]),e._v(" "),i("p",[e._v("重启防火墙搞定，\nsudo systemctl restart firewalld")]),e._v(" "),i("p",[e._v("再检查下\nsudo systemctl status firewalld\nsudo systemctl status nginx\n访问  OK，\n因为用的是别人的反代  周末试下自己搞。")]),e._v(" "),i("hr")])}),[],!1,null,null,null);i.default=s.exports}}]);